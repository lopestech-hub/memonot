# CONTEXTO.MD â€” MemÃ³ria do Projeto MemoNot

> MemÃ³ria viva do projeto. Atualizado automaticamente pelo Claude apÃ³s qualquer mudanÃ§a e obrigatoriamente antes de encerrar cada sessÃ£o.

---

## ğŸ¯ Objetivo do Sistema
Aplicativo desktop de notas multi-usuÃ¡rio com suporte a texto normal e Markdown. Permite criaÃ§Ã£o, ediÃ§Ã£o, organizaÃ§Ã£o e busca de notas com preview em tempo real do Markdown.

## ğŸ‘¥ UsuÃ¡rios e Perfis
- **UsuÃ¡rios**: MÃºltiplos usuÃ¡rios com contas isoladas (multi-tenancy)
- **AutenticaÃ§Ã£o**: Login/senha por usuÃ¡rio
- **Isolamento**: Cada usuÃ¡rio vÃª apenas suas prÃ³prias notas

## âš™ï¸ Regras de NegÃ³cio
- Multi-tenancy completo (notas isoladas por usuÃ¡rio)
- Suporte a texto normal e Markdown
- Preview em tempo real do Markdown
- Busca textual em todas as notas
- OrganizaÃ§Ã£o por categorias
- Interface desktop (Electron)
- MVP: sem integraÃ§Ãµes externas, sem suporte a imagens

---

## ğŸ“¦ Stack TecnolÃ³gica

### Frontend
- Framework: React + Vite + TypeScript
- Estilo: Tailwind CSS
- Ãcones: react-icons
- Libs: @uiw/react-md-editor (editor Markdown), react-markdown (preview), Zustand (estado), date-fns (datas), react-hook-form + Zod (formulÃ¡rios)

### Backend
- Runtime: Node.js
- Framework: Fastify (leve e rÃ¡pido para API)
- ORM: Prisma
- Banco: PostgreSQL
- Libs: JWT (autenticaÃ§Ã£o), bcrypt (senhas)

### AutenticaÃ§Ã£o
- EstratÃ©gia: JWT manual com refresh token
- Detalhes: Controle total para multi-tenancy

### MCP
- Nome do MCP do banco: **A definir** (precisa configurar)
- Usar sempre para consultas ao banco

### Infraestrutura
- Hospedagem: VPS com EasyPanel
- Deploy: Dockerfile Ãºnico na raiz
- Banco: sempre na VPS, nunca local
- Desktop: Electron empacotando app web
- Timezone: America/Sao_Paulo (UTC-3)

---

## ï¿½ï¸ Banco de Dados

### Tabelas
- **usuarios**: Contas dos usuÃ¡rios com autenticaÃ§Ã£o
- **notas**: ConteÃºdo das notas (texto e Markdown)
- **categorias**: OrganizaÃ§Ã£o das notas

### Prisma Schema Completo e Atualizado
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model usuario {
  id            String    @id @default(uuid())
  nome          String
  email         String    @unique
  senha         String
  criado_em     DateTime  @default(now())
  atualizado_em DateTime  @updatedAt
  deletado_em   DateTime?

  notas       nota[]
  categorias  categoria[]
}

model categoria {
  id            String    @id @default(uuid())
  nome          String
  usuario_id    String
  criado_em     DateTime  @default(now())
  atualizado_em DateTime  @updatedAt
  deletado_em   DateTime?

  usuario usuario @relation(fields: [usuario_id], references: [id])
  notas   nota[]
}

model nota {
  id            String    @id @default(uuid())
  titulo        String
  conteudo      String    // Texto normal ou Markdown
  tipo          tipo_nota @default(TEXTO)
  categoria_id  String?
  usuario_id    String
  criado_em     DateTime  @default(now())
  atualizado_em DateTime  @updatedAt
  deletado_em   DateTime?

  usuario   usuario   @relation(fields: [usuario_id], references: [id])
  categoria categoria? @relation(fields: [categoria_id], references: [id])
}

enum tipo_nota {
  TEXTO
  MARKDOWN
}
```

### Scripts de MigraÃ§Ã£o Criados
- Nenhum ainda - banco nÃ£o configurado

### DecisÃµes Importantes
- Usamos soft delete (deletado_em) para preservar dados
- Campo tipo_nota para diferenciar texto de Markdown
- Relacionamento opcional com categorias
- Multi-tenancy via usuario_id em todas as tabelas

---

## ğŸ”Œ Rotas da API

### AutenticaÃ§Ã£o
| MÃ©todo | Rota | DescriÃ§Ã£o | Auth |
|--------|------|-----------|------|
| POST | /auth/registro | Criar nova conta | âŒ |
| POST | /auth/login | Login do usuÃ¡rio | âŒ |
| POST | /auth/refresh | Renovar token | âŒ |
| GET | /auth/eu | Perfil do usuÃ¡rio | âœ… |

### Notas
| MÃ©todo | Rota | DescriÃ§Ã£o | Auth |
|--------|------|-----------|------|
| GET | /notas | Listar notas do usuÃ¡rio | âœ… |
| POST | /notas | Criar nova nota | âœ… |
| GET | /notas/:id | Buscar nota especÃ­fica | âœ… |
| PUT | /notas/:id | Atualizar nota | âœ… |
| DELETE | /notas/:id | Deletar nota | âœ… |
| GET | /notas/busca | Buscar textual | âœ… |

### Categorias
| MÃ©todo | Rota | DescriÃ§Ã£o | Auth |
|--------|------|-----------|------|
| GET | /categorias | Listar categorias | âœ… |
| POST | /categorias | Criar categoria | âœ… |
| PUT | /categorias/:id | Atualizar categoria | âœ… |
| DELETE | /categorias/:id | Deletar categoria | âœ… |

---

## ğŸ“ Estrutura de Pastas Atual
```
MemoNot/
â”œâ”€â”€ .windsurf/
â”‚   â””â”€â”€ rules/
â”‚       â””â”€â”€ regras-trabalho.md    â† Regras de trabalho configuradas
â”œâ”€â”€ frontend/                     â† App React + TypeScript
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/               â† PÃ¡ginas (Login, Dashboard, Notas)
â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ index.css
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ backend/                      â† API Fastify + Prisma
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/              â† Rotas da API
â”‚   â”‚   â”œâ”€â”€ plugins/             â† Plugins Fastify
â”‚   â”‚   â”œâ”€â”€ types/               â† Tipos TypeScript
â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma        â† Schema do banco
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ Dockerfile                    â† Build Ãºnico
â”œâ”€â”€ .env.example                  â† VariÃ¡veis de ambiente
â”œâ”€â”€ README.md                     â† DocumentaÃ§Ã£o
â””â”€â”€ CONTEXTO.MD                   â† Este arquivo (memÃ³ria do projeto)
```

---

## ğŸ”§ VariÃ¡veis de Ambiente
```env
# Banco de Dados
DATABASE_URL="postgresql://user:password@localhost:5432/memonot?schema=public"

# Timezone â€” OBRIGATÃ“RIO
TZ=America/Sao_Paulo
PGTZ=America/Sao_Paulo

# AutenticaÃ§Ã£o
JWT_SECRET=sua_chave_secreta_aqui
JWT_EXPIRES_IN=10h
JWT_REFRESH_EXPIRES_IN=7d

# App
PORT=3000
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

---

## ğŸ“‹ IntegraÃ§Ãµes Externas
Nenhuma para MVP. Futuramente:
- ExportaÃ§Ã£o PDF
- SincronizaÃ§Ã£o nuvem
- IntegraÃ§Ãµes com Google Drive, Notion

---

## ğŸš€ Roadmap

### Fase 1 â€” Setup e AutenticaÃ§Ã£o âœ…
- [x] Estrutura do projeto (frontend/backend)
- [x] Dockerfile Ãºnico
- [x] Prisma e banco PostgreSQL
- [x] AutenticaÃ§Ã£o JWT
- [x] Interface Electron bÃ¡sica

### Fase 2 â€” Core do NegÃ³cio
- [x] CRUD de notas (real)
- [x] Editor Markdown com preview
- [x] Categorias (real)
- [x] Busca textual
- [x] Listagem em cards/listas
- [x] Salvamento automÃ¡tico

### Fase 3 â€” Funcionalidades AvanÃ§adas âœ…
- [x] Melhorias na UI/UX
- [x] Atalhos de teclado
- [x] Temas claro/escuro
- [x] ExportaÃ§Ã£o de notas

### Fase 4 â€” Refinamentos
- [ ] Testes automatizados
- [ ] OtimizaÃ§Ãµes de performance
- [ ] Empacotamento para distribuiÃ§Ã£o

---

## ğŸ“ DecisÃµes TÃ©cnicas
- **21/02/2026**: Fastify escolhido por ser mais leve que NestJS para API simples
- **21/02/2026**: Electron para desktop em vez de app nativo (reaproveitamento web)
- **21/02/2026**: @uiw/react-md-editor para editor Markdown com preview integrado

## âš ï¸ Problemas Conhecidos
Nenhum ainda - projeto em planejamento

## ğŸ“… O que foi feito na Ãºltima sessÃ£o
- **Banco de dados configurado**: PostgreSQL conectado com schema Prisma
- **AutenticaÃ§Ã£o real**: JWT completo com registro, login e perfil
- **API funcional**: Rotas de auth, notas e categorias com Prisma
- **Frontend conectado**: Stores Zustand com axios e estado global
- **UI real**: Dashboard com dados dinÃ¢micos do banco
- **ProteÃ§Ã£o de rotas**: Componente ProtectedRoute implementado
- **NotesPage completa**: CRUD real com salvamento automÃ¡tico a cada 2s
- **Lembrar-me**: OpÃ§Ã£o de salvar credenciais no login com localStorage
- **RegisterPage corrigida**: Agora salva usuÃ¡rios no banco de dados
- **Todos os mocks removidos**: Backend 100% funcional com Prisma
- **Busca textual implementada**: Busca por tÃ­tulo e conteÃºdo (case-insensitive)
- **CRUD completo**: Todas as operaÃ§Ãµes de notas e categorias funcionando
- **Design System Violet**: Redesign completo seguindo skill @design-engineer
- **Sidebar Ã  esquerda**: NavegaÃ§Ã£o lateral com logo, menu e categorias
- **UI/UX refinada**: Interface 20% mais compacta, Ã­cones sem fundos, responsividade
- **Atalhos de teclado**: Ctrl+Alt+D/L/N para navegaÃ§Ã£o, Ctrl+Shift+F para busca
- **Tema claro/escuro**: Toggle persistente com CSS variables, transiÃ§Ãµes suaves
- **ExportaÃ§Ã£o de notas**: Markdown (.md), HTML (.html) e Texto (.txt) com um clique
- **Electron Desktop**: Aplicativo nativo Windows empacotando frontend, conecta Ã  VPS

## ğŸ¨ Design System Aplicado
- **DireÃ§Ã£o**: Warmth & Approachability + Utility & Function
- **Cor principal**: Violet (#8b5cf6) - criatividade e foco
- **Cor secundÃ¡ria**: Emerald (#10b981) - categorias e sucesso
- **Neutros**: Slate (slate-50 a slate-900)
- **Tipografia**: Inter font, tamanhos reduzidos 20% (base 12.8px)
- **Componentes**: BotÃµes h-8, inputs h-8, cards rounded-lg, borders slate-200
- **EspaÃ§amento**: Grid reduzido 20%, gaps menores
- **Ãcones**: Reduzidos 20% (h-4 w-4 padrÃ£o)
- **TransiÃ§Ãµes**: 150ms ease em todos os elementos interativos
- **Arquivo**: `.design-engineer/system.md` com documentaÃ§Ã£o completa
- **Densidade**: Interface mais compacta para melhor aproveitamento de espaÃ§o

## â¡ï¸ PrÃ³ximos Passos

### Deploy Backend na VPS:
1. **Criar banco PostgreSQL** no EasyPanel
2. **Configurar variÃ¡veis de ambiente** (DATABASE_URL, JWT_SECRET, etc.)
3. **Push para Git** - `git push origin main`
4. **Criar app no EasyPanel** - Conectar repositÃ³rio Git
5. **Deploy automÃ¡tico** - EasyPanel builda com Dockerfile
6. **Rodar migraÃ§Ãµes** - `npx prisma migrate deploy`

### Electron Desktop:
1. **Instalar dependÃªncias** - `cd frontend && npm install`
2. **Configurar .env** - URL da VPS em `frontend/.env`
3. **Testar** - `npm run electron:dev`
4. **Gerar executÃ¡vel** - `npm run electron:build`
5. **Distribuir** - Compartilhar o instalador .exe

### Melhorias Futuras:
- Gerenciamento de categorias (modal criar/editar/deletar)
- Testes automatizados (Unit + E2E)
- OtimizaÃ§Ãµes de performance

## ğŸ“… HistÃ³rico de MudanÃ§as
- **21/02/2026**: Planejamento completo - stack, schema, rotas, roadmap definidos
- **21/02/2026**: Fase 1 implementada - estrutura, interfaces bÃ¡sicas, mocks da API
- **21/02/2026**: ConexÃ£o real - banco PostgreSQL, autenticaÃ§Ã£o JWT, API funcional, frontend conectado
- **21/02/2026**: NotesPage completa - salvamento automÃ¡tico, CRUD real
- **21/02/2026**: Design System Violet - redesign completo com @design-engineer skill
- **21/02/2026**: Fase 3 COMPLETA âœ… - UI/UX refinada, atalhos, tema claro/escuro, exportaÃ§Ã£o de notas
- **21/02/2026**: Electron configurado - App desktop pronto para build, conecta Ã  VPS
- **21/02/2026**: Deploy configurado - Dockerfile otimizado, .dockerignore, guia completo de deploy
